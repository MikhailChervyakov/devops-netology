# Домашнее задание к занятию 5. «Оркестрация кластером Docker контейнеров на примере Docker Swarm»

## Как сдавать задания

Обязательны к выполнению задачи без звёздочки. Их нужно выполнить, чтобы получить зачёт и диплом о профессиональной переподготовке.

Задачи со звёдочкой (*) — это дополнительные задачи и/или задачи повышенной сложности. Их выполнять не обязательно, но они помогут вам глубже понять тему.

Домашнее задание выполните в файле readme.md в GitHub-репозитории. В личном кабинете отправьте на проверку ссылку на .md-файл в вашем репозитории.

Любые вопросы по решению задач задавайте в чате учебной группы.

---


## Важно

1. Перед отправкой работы на проверку удаляйте неиспользуемые ресурсы.
Это нужно, чтобы не расходовать средства, полученные в результате использования промокода.
Подробные рекомендации [здесь](https://github.com/netology-code/virt-homeworks/blob/virt-11/r/README.md).

2. [Ссылки для установки открытого ПО](https://github.com/netology-code/devops-materials/blob/master/README.md).

---

## Задача 1

Дайте письменые ответы на вопросы:

- В чём отличие режимов работы сервисов в Docker Swarm-кластере: replication и global?
```
Существует два типа развертывания сервисов: replicated и global.

Для реплицированного сервиса вы указываете, сколько идентичных задач хотите запустить. Например, вы решили развернуть сервис HTTP с тремя репликами, каждая из которых обслуживает один и тот же контент.

Глобальный сервис — это сервис, который запускает одну задачу на каждой ноде. Предварительно заданного количества задач нет. Каждый раз, когда вы добавляете ноду в swarm, оркестратор создает задачу, а планировщик назначает задачу новой ноде. По официальной документации, хорошими кандидатами на роль глобальных сервисов являются агенты мониторинга, антивирусные сканеры или другие типы контейнеров, которые вы хотите запустить на каждой ноде в swarm.
```
- Какой алгоритм выбора лидера используется в Docker Swarm-кластере?
```
Raft — алгоритм для решения задач консенсуса в сети ненадёжных вычислений. Разрабатывался с учётом недостатков более старого алгоритма Паксос. При выборе ключевых идей, предпочтение отдавалось более простым и практичным решениям. Тем не менее, несмотря на относительную простоту, Raft обеспечивает безопасную и эффективную реализацию машины состояний поверх кластерной вычислительной системы.
Протокол RAFT использует следующие механизмы для обеспечения согласованности данных:

- Выборы лидера: если текущий лидер выходит из строя, кандидаты начинают выборы, чтобы определить нового лидера.
- Журналирование: каждый узел ведет журнал изменений данных, чтобы обеспечить согласованность их состояния.
- Коммиты: лидер отправляет запросы на изменение данных всем узлам, и только после получения подтверждения от большинства узлов изменения считаются примененными.

Протокол RAFT является более простым и понятным, чем другие протоколы распределенного консенсуса, такие как Paxos. Он также обеспечивает высокую доступность и отказоустойчивость системы.

```
- Что такое Overlay Network?
```
Overlay Network (сеть наложения) - это сеть, построенная поверх другой сети, такой как Интернет. Она используется для связи между узлами, которые могут быть расположены в разных частях мира и иметь различные IP-адреса. Overlay Network позволяет узлам обмениваться данными и ресурсами, не зависимо от физического расположения.

Overlay Network может быть построена на основе различных протоколов, таких как Virtual Private Network (VPN), Peer-to-Peer (P2P) и Content Delivery Network (CDN). Каждый протокол имеет свои особенности и применяется в различных сферах, например, VPN используется для обеспечения безопасности соединения между удаленными узлами, P2P - для обмена файлами и ресурсами между пользователями, а CDN - для доставки контента пользователю из ближайшего сервера.

Overlay Network может использоваться для решения различных задач, таких как увеличение пропускной способности сети, повышение доступности и отказоустойчивости системы, обеспечение безопасности передачи данных и др. Она является важным инструментом в современных распределенных системах и приложениях, таких как блокчейн и Интернет вещей.
```

## Задача 2

Создайте ваш первый Docker Swarm-кластер в Яндекс Облаке.

Чтобы получить зачёт, предоставьте скриншот из терминала (консоли) с выводом команды:
```
docker node ls
```
```
1. Берем образ centos из предыдущей лабы, правим его, при необходимости (folder,token,network) создаем образ коммандой
 packer build centos-7-base.json

2. Заполняем необходимые поля в variales. Настраиваем зеркала яндекса и поднимаем terraform
terraform init
3. Добавил ansible_port=22 в inventory.tf
4  terraform apply
```
![](https://github.com/MikhailChervyakov/devops-netology/blob/main/05-virt-05-docker-swarm/images/1.png)
![](https://github.com/MikhailChervyakov/devops-netology/blob/main/05-virt-05-docker-swarm/images/2.png)
![](https://github.com/MikhailChervyakov/devops-netology/blob/main/05-virt-05-docker-swarm/images/3.png)
## Задача 3

Создайте ваш первый, готовый к боевой эксплуатации кластер мониторинга, состоящий из стека микросервисов.

Чтобы получить зачёт, предоставьте скриншот из терминала (консоли), с выводом команды:
```
docker service ls
```
![](https://github.com/MikhailChervyakov/devops-netology/blob/main/05-virt-05-docker-swarm/images/4.png)
![](https://github.com/MikhailChervyakov/devops-netology/blob/main/05-virt-05-docker-swarm/images/5.png)
![](https://github.com/MikhailChervyakov/devops-netology/blob/main/05-virt-05-docker-swarm/images/6.png)
![](https://github.com/MikhailChervyakov/devops-netology/blob/main/05-virt-05-docker-swarm/images/7.png)


## Задача 4 (*)

Выполните на лидере Docker Swarm-кластера команду, указанную ниже, и дайте письменное описание её функционала — что она делает и зачем нужна:
```
# см.документацию: https://docs.docker.com/engine/swarm/swarm_manager_locking/
docker swarm update --autolock=true
```


